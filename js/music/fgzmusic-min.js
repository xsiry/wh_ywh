var scrollt=0;var tflag=0;var lytext=new Array();var lytime=new Array();var delay=10;var line=0;var scrollh=0;var songIndex=1;var _timelineWidth=462;var agentUrl="http://115.238.227.158:8080/fgzweb";var playUrl="http://115.238.227.158:8080";var playObj=null;var _fll_control=false;function GetRequest(){var b=location.search;var a=new Object();if(b.indexOf("?")!=-1){var d=b.substr(1);strs=d.split("&");for(var c=0;c<strs.length;c++){a[strs[c].split("=")[0]]=unescape(strs[c].split("=")[1])}}return a}function startAllEvent(){$("#lyr").rollbar({zIndex:100});console.log("--start---");$(".start em").click(function(){console.log("---start---");songIndex=$(this).attr("sonN");var b=$(this).data("songid");var a=$(this).data("imgurl");$(".start em").css({background:"",color:""});$(".manyou").remove();$(".songList").css("background-color","#f5f5f5");$(this).css({background:'url("../../images/T1X4JEFq8qXXXaYEA_-11-12.gif") no-repeat',color:"transparent"});$(".music_white").removeClass("music_white");$(this).parent().parent().parent().css("background-color","#f0f0f0");$(this).parent().parent().addClass().addClass("music_white");var d=$(this).parent().parent().find(".colsn").html();var c=$(this).parent().parent().find(".colcn").html();$(".songName").html(d);$(".songPlayer").html(c);if((a)&&(a.indexOf("hiphotos")==-1)){$("#AlbumImg").attr("src",a);$("#AlbumImg").load(function(){loadBG(a)})}else{$("#AlbumImg").attr("src","../../images/nofind.jpg")}$(".blur").css("opacity","0");$(".blur").animate({opacity:"1"},1000);$.getJSON(agentUrl+"/mp3AgentServer/",{song_id:b},function(e){console.log("--getJSON music--");showLrcInfo(e.song_lrc_info);_fll_control=false;$(".iplay").css("background",'url("../../images/T1oHFEFwGeXXXYdLba-18-18.gif") 0 0');$(".playBtn").css("background-position","0 -30px");$(".playBtn").attr("isplay","1");stop();play(playUrl+e.mp3path)})});$(".pinBtn").click(function(){$(this).toggleClass("pinBtn-no");$(this).toggleClass("pinBtn-yes")});$(".songList").dblclick(function(){var a=$(this).find(".start em").html();$(".start em[sonN="+a+"]").click()});$(".dian").draggable({containment:".pro2",drag:function(){$(".dian").css({top:"0px;"});if($(".playBtn").attr("isplay")=="0"){return}var a=$(".dian").css("left");var b=parseInt(a);console.log("le:="+b);var d=Math.floor(myListener.duration/1000);console.log("_duration:="+d);var c=d*(b/_timelineWidth);console.log("apos:="+c);setPosition(c*1000);console.log("--------------------------------")}});$(".dian2").draggable({containment:".volControl",drag:function(){var a=$(".dian2").css("left");var b=parseInt(a);setVolume(b)}});$(".playBtn").click(function(){var b=$(this);var a=b.attr("isplay");if(a==0){b.css("background-position","0 -30px");b.attr("isplay","1");play()}if(a==1){b.css("background-position","");b.attr("isplay","0");pause()}});$(".prevBtn").click(function(){var a=parseInt(songIndex)-1;$(".start em[sonN="+a+"]").click()});$(".nextBtn").click(function(){var a=parseInt(songIndex)+1;$(".start em[sonN="+a+"]").click()});fPlay();loadBG()}function fPlay(){$(".start em[sonN="+songIndex+"]").click()}function loadBG(d){var e=document.getElementById("canvas");var a=e.getContext("2d");var b=document.getElementById("AlbumImg");a.drawImage(b,0,0,942,510);a=null;e=null;b=null}function calcTime(c){var a;var d;var b;a=String(parseInt(c/3600,10));if(a.length==1){a="0"+a}d=String(parseInt((c%3600)/60,10));if(d.length==1){d="0"+d}b=String(parseInt(c%60,10));if(b.length==1){b="0"+b}return d+":"+b}function show(c){var d=document.getElementById("lyr");document.getElementById("lyr").innerHTML=" ";if(c<lytime[lytime.length-1]){for(var a=0;a<lytext.length;a++){if(lytime[a]<=c&&c<lytime[a+1]){scrollh=a*25;d.innerHTML+="<font color=#f60 style=font-weight:bold>"+lytext[a]+"</font><br>"}else{if(c<lytime[lytime.length-1]){d.innerHTML+=lytext[a]+"<br>"}}}}else{for(var b=0;b<lytext.length-1;b++){d.innerHTML+=lytext[b]+"<br>"}d.innerHTML+="<font color=red style=font-weight:bold>"+lytext[lytext.length-1]+"</font><br>"}}function scrollBar(){if(document.getElementById("lyr").scrollTop<=scrollh){document.getElementById("lyr").scrollTop+=1}if(document.getElementById("lyr").scrollTop>=scrollh+50){document.getElementById("lyr").scrollTop-=1}window.setTimeout("scrollBar()",delay)}var showLrcInfo=function(a){$("#lry").html("");if(a==""){$("#lry").html("\u672c\u6b4c\u6682\u65e0\u6b4c\u8bcd\uff01")}var c=a.split("\n");tflag=0;for(var b=0;b<lytext.length;b++){lytext[b]=""}for(var b=0;b<lytime.length;b++){lytime[b]=""}document.getElementById("lyr").scrollTop=0;for(var b=0;b<c.length;b++){sToArray(c[b])}sortAr();scrollBar()};function sToArray(e){var c=0;var d=new Array();for(var a=0;a<e.length;a++){if(e.charAt(a)=="["){d[c]=a;c++}}if(c!=0){for(var b=0;b<d.length;b++){lytext[tflag]=e.substring(e.lastIndexOf("]")+1);lytime[tflag]=conSeconds(e.substring(d[b]+1,d[b]+6));tflag++}}}function sortAr(){var b=null;var d=null;for(var a=0;a<lytime.length;a++){for(var c=0;c<lytime.length-a;c++){if(lytime[c]>lytime[c+1]){b=lytime[c];d=lytext[c];lytime[c]=lytime[c+1];lytext[c]=lytext[c+1];lytime[c+1]=b;lytext[c+1]=d}}}}function conSeconds(c){var a=c.substring(0,c.indexOf(":"));var d=c.substring(c.indexOf(":")+1);a=parseInt(a.replace(/0/,""));var b=parseInt(a)*60+parseInt(d);return b}var myListener=new Object();myListener.onInit=function(){this.position=0;console.log("---myListener.onInit---")};myListener.onUpdate=function(){if($(".playBtn").attr("isplay")=="0"){return}if((this.position==0)&&_fll_control){if($(".playBtn").attr("isplay")=="1"){_fll_control=false;ended()}}else{if(this.position>1){_fll_control=true}var f=this.duration/1000;var a=this.position/1000;var c=calcTime(Math.floor(f));$(".duration").html(c);var g=calcTime(Math.floor(a));$(".position").html(g);var e=10;var h=10;var d=h+_timelineWidth-e;var b=h+Math.round((_timelineWidth-e)*a/f);if(b<h){b=h}if(b>d){b=d}$(".dian").css("left",b+"px");show(a)}};function getFlashObject(){return document.getElementById("myflashAudio")}function play(a){console.log(" play:="+myListener.position);if(myListener.position==0){console.log("mp3file:="+a);getFlashObject().SetVariable("method:setUrl",a)}getFlashObject().SetVariable("method:play","");getFlashObject().SetVariable("enabled","true")}function pause(){getFlashObject().SetVariable("method:pause","")}function stop(){getFlashObject().SetVariable("method:stop","");myListener.position=0}function setPosition(a){getFlashObject().SetVariable("method:setPosition",a)}function setVolume(a){getFlashObject().SetVariable("method:setVolume",a)}function ended(){var a=parseInt(songIndex)+1;$(".start em[sonN="+a+"]").click()}$(function(){console.log("--\u9875\u9762\u52a0\u8f7d\u5b8c\u6210---");var a={interval:"500",listener:"myListener"};var c={AllowScriptAccess:"always",movie:"../../video/swf/player_mp3_js.swf"};var b={id:"myflashAudio"};console.log("--\u5f00\u59cb\u52a0\u8f7dFLASH---");swfobject.embedSWF("../../video/swf/player_mp3_js.swf","dewplayer_content","1","1","9.0.0","../../video/swf/expressinstall.swf",a,c,b,function(){console.log("--\u5f00\u59cb\u52a0\u8f7dFLASH IS OK---")});document.onselectstart=function(){return false}});
